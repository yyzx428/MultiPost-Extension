<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MultiPost Extension - æ–‡ä»¶æ“ä½œæµ‹è¯•</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            background: #fafafa;
        }
        .section h3 {
            margin-top: 0;
            color: #555;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #666;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        button {
            background: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background: #005a87;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .result {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .path-input {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        .path-input input {
            flex: 1;
            margin-right: 10px;
        }
        .path-input button {
            padding: 6px 12px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>MultiPost Extension - æ–‡ä»¶æ“ä½œæµ‹è¯•</h1>
        
        <!-- çŠ¶æ€æ£€æŸ¥ -->
        <div class="section">
            <h3>ğŸ” æ‰©å±•çŠ¶æ€æ£€æŸ¥</h3>
            <div id="extensionStatus" class="status info">æ­£åœ¨æ£€æŸ¥æ‰©å±•çŠ¶æ€...</div>
            <button onclick="checkExtensionStatus()">é‡æ–°æ£€æŸ¥</button>
            <button onclick="detectPlatform()">æ£€æµ‹å½“å‰å¹³å°</button>
        </div>

        <!-- ç™¾åº¦äº‘åˆ†äº«æµ‹è¯• -->
        <div class="section">
            <h3>ğŸ“ ç™¾åº¦äº‘åˆ†äº«æµ‹è¯•</h3>
            <div class="form-group">
                <label>æ–‡ä»¶è·¯å¾„ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰ï¼š</label>
                <div id="pathInputs">
                    <div class="path-input">
                        <input type="text" placeholder="ä¾‹å¦‚ï¼šæˆ‘çš„æ‰‹æŠ„æŠ¥" value="æˆ‘çš„æ‰‹æŠ„æŠ¥">
                        <button onclick="removePath(this)">åˆ é™¤</button>
                    </div>
                    <div class="path-input">
                        <input type="text" placeholder="ä¾‹å¦‚ï¼š041" value="041">
                        <button onclick="removePath(this)">åˆ é™¤</button>
                    </div>
                </div>
                <button onclick="addPath()">æ·»åŠ è·¯å¾„</button>
            </div>
            
            <div class="form-group">
                <label>æœ‰æ•ˆæœŸï¼š</label>
                <select id="validPeriod">
                    <option value="1å¤©">1å¤©</option>
                    <option value="7å¤©" selected>7å¤©</option>
                    <option value="30å¤©">30å¤©</option>
                    <option value="365å¤©">365å¤©</option>
                    <option value="æ°¸ä¹…æœ‰æ•ˆ">æ°¸ä¹…æœ‰æ•ˆ</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>æå–ç ï¼š</label>
                <select id="extractCodeType" onchange="toggleCustomCode()">
                    <option value="ä¸è®¾ç½®">ä¸è®¾ç½®</option>
                    <option value="éšæœºç”Ÿæˆ" selected>éšæœºç”Ÿæˆ</option>
                    <option value="è‡ªå®šä¹‰">è‡ªå®šä¹‰</option>
                </select>
            </div>
            
            <div class="form-group" id="customCodeGroup" style="display:none;">
                <label>è‡ªå®šä¹‰æå–ç ï¼š</label>
                <input type="text" id="customCode" placeholder="è¯·è¾“å…¥4ä½æå–ç " maxlength="4">
            </div>
            
            <button onclick="testBaiduShare()" id="shareBtn">åˆ›å»ºåˆ†äº«</button>
            <button onclick="testQuickShare()">å¿«é€Ÿåˆ†äº«ï¼ˆé»˜è®¤é…ç½®ï¼‰</button>
        </div>

        <!-- æ“ä½œç»“æœ -->
        <div class="section">
            <h3>ğŸ“‹ æ“ä½œç»“æœ</h3>
            <div id="result" class="result">æš‚æ— æ“ä½œç»“æœ</div>
            <button onclick="clearResult()">æ¸…ç©ºç»“æœ</button>
        </div>

        <!-- ä½¿ç”¨è¯´æ˜ -->
        <div class="section">
            <h3>ğŸ“– ä½¿ç”¨è¯´æ˜</h3>
            <ol>
                <li>ç¡®ä¿å·²å®‰è£… MultiPost Extension æµè§ˆå™¨æ‰©å±•</li>
                <li>åœ¨ç™¾åº¦ç½‘ç›˜é¡µé¢æ‰“å¼€æ­¤æµ‹è¯•é¡µé¢ï¼ˆå¯é€šè¿‡ä¹¦ç­¾æˆ–æ§åˆ¶å°è¿è¡Œï¼‰</li>
                <li>é…ç½®æ–‡ä»¶è·¯å¾„å’Œåˆ†äº«å‚æ•°</li>
                <li>ç‚¹å‡»"åˆ›å»ºåˆ†äº«"æŒ‰é’®æ‰§è¡Œæ“ä½œ</li>
                <li>æŸ¥çœ‹æ“ä½œç»“æœå’Œæ—¥å¿—ä¿¡æ¯</li>
            </ol>
            
            <h4>ä»£ç ç¤ºä¾‹ï¼š</h4>
            <div class="result">
// åŸºç¡€ç”¨æ³•
const result = await window.multipostExtension.fileOperation({
    platform: 'baiduyun',
    operation: 'share',
    params: {
        paths: ['æˆ‘çš„æ‰‹æŠ„æŠ¥', '041'],
        shareConfig: {
            validPeriod: '7å¤©',
            extractCodeType: 'éšæœºç”Ÿæˆ'
        }
    }
});

// ä¾¿æ·æ–¹æ³•
const result = await window.createBaiduYunShare(
    ['æˆ‘çš„æ‰‹æŠ„æŠ¥', '041'], 
    {
        validPeriod: '7å¤©',
        extractCodeType: 'éšæœºç”Ÿæˆ'
    }
);
            </div>
        </div>
    </div>

    <script>
        let extensionReady = false;

        // æ£€æŸ¥æ‰©å±•çŠ¶æ€
        function checkExtensionStatus() {
            const statusDiv = document.getElementById('extensionStatus');
            
            if (window.multipostExtension) {
                statusDiv.className = 'status success';
                statusDiv.textContent = 'âœ… MultiPost Extension å·²å°±ç»ªï¼Œæ–‡ä»¶æ“ä½œåŠŸèƒ½å¯ç”¨';
                extensionReady = true;
            } else {
                statusDiv.className = 'status error';
                statusDiv.textContent = 'âŒ MultiPost Extension æœªæ£€æµ‹åˆ°ï¼Œè¯·ç¡®ä¿å·²å®‰è£…å¹¶å¯ç”¨æ‰©å±•';
                extensionReady = false;
            }
        }

        // æ£€æµ‹å½“å‰å¹³å°
        function detectPlatform() {
            const hostname = window.location.hostname;
            const statusDiv = document.getElementById('extensionStatus');
            
            let platform = 'unknown';
            if (hostname.includes('pan.baidu.com')) platform = 'baiduyun';
            else if (hostname.includes('aliyundrive.com')) platform = 'aliyun';
            else if (hostname.includes('onedrive.live.com')) platform = 'onedrive';
            
            const message = `å½“å‰å¹³å°: ${platform} (${hostname})`;
            addResult('info', `å¹³å°æ£€æµ‹: ${message}`);
        }

        // æ·»åŠ è·¯å¾„è¾“å…¥æ¡†
        function addPath() {
            const pathInputs = document.getElementById('pathInputs');
            const div = document.createElement('div');
            div.className = 'path-input';
            div.innerHTML = `
                <input type="text" placeholder="è¾“å…¥è·¯å¾„">
                <button onclick="removePath(this)">åˆ é™¤</button>
            `;
            pathInputs.appendChild(div);
        }

        // åˆ é™¤è·¯å¾„è¾“å…¥æ¡†
        function removePath(button) {
            button.parentElement.remove();
        }

        // åˆ‡æ¢è‡ªå®šä¹‰æå–ç è¾“å…¥
        function toggleCustomCode() {
            const select = document.getElementById('extractCodeType');
            const group = document.getElementById('customCodeGroup');
            group.style.display = select.value === 'è‡ªå®šä¹‰' ? 'block' : 'none';
        }

        // è·å–è·¯å¾„æ•°ç»„
        function getPaths() {
            const inputs = document.querySelectorAll('#pathInputs input');
            return Array.from(inputs)
                .map(input => input.value.trim())
                .filter(path => path.length > 0);
        }

        // æµ‹è¯•ç™¾åº¦äº‘åˆ†äº«
        async function testBaiduShare() {
            if (!extensionReady) {
                addResult('error', 'æ‰©å±•æœªå°±ç»ªï¼Œæ— æ³•æ‰§è¡Œæ“ä½œ');
                return;
            }

            const shareBtn = document.getElementById('shareBtn');
            shareBtn.disabled = true;
            shareBtn.textContent = 'æ“ä½œä¸­...';

            try {
                const paths = getPaths();
                if (paths.length === 0) {
                    throw new Error('è¯·è‡³å°‘è¾“å…¥ä¸€ä¸ªè·¯å¾„');
                }

                const validPeriod = document.getElementById('validPeriod').value;
                const extractCodeType = document.getElementById('extractCodeType').value;
                const customCode = document.getElementById('customCode').value;

                addResult('info', `å¼€å§‹åˆ›å»ºåˆ†äº«: ${paths.join(' -> ')}`);

                const request = {
                    platform: 'baiduyun',
                    operation: 'share',
                    params: {
                        paths,
                        shareConfig: {
                            validPeriod,
                            extractCodeType,
                            ...(extractCodeType === 'è‡ªå®šä¹‰' && customCode ? { customCode } : {})
                        }
                    }
                };

                const result = await window.multipostExtension.fileOperation(request);
                
                if (result.success) {
                    addResult('success', 'åˆ†äº«åˆ›å»ºæˆåŠŸï¼');
                    addResult('info', `æ‰§è¡Œæ—¶é—´: ${result.executionTime}ms`);
                    addResult('data', JSON.stringify(result.data, null, 2));
                    if (result.logs.length > 0) {
                        addResult('logs', 'æ“ä½œæ—¥å¿—:\n' + result.logs.map(log => 
                            `[${new Date(log.timestamp).toLocaleTimeString()}] ${log.level.toUpperCase()}: ${log.message}`
                        ).join('\n'));
                    }
                } else {
                    addResult('error', 'åˆ†äº«åˆ›å»ºå¤±è´¥');
                    addResult('data', JSON.stringify(result, null, 2));
                }

            } catch (error) {
                addResult('error', `æ“ä½œå¤±è´¥: ${error.message}`);
                console.error('åˆ†äº«æ“ä½œå¤±è´¥:', error);
            } finally {
                shareBtn.disabled = false;
                shareBtn.textContent = 'åˆ›å»ºåˆ†äº«';
            }
        }

        // å¿«é€Ÿåˆ†äº«æµ‹è¯•
        async function testQuickShare() {
            if (!window.createBaiduYunShare) {
                addResult('error', 'ä¾¿æ·æ–¹æ³•ä¸å¯ç”¨');
                return;
            }

            try {
                const paths = getPaths();
                if (paths.length === 0) {
                    throw new Error('è¯·è‡³å°‘è¾“å…¥ä¸€ä¸ªè·¯å¾„');
                }

                addResult('info', `ä½¿ç”¨ä¾¿æ·æ–¹æ³•åˆ›å»ºåˆ†äº«: ${paths.join(' -> ')}`);

                const result = await window.createBaiduYunShare(paths);
                
                addResult('success', 'å¿«é€Ÿåˆ†äº«åˆ›å»ºæˆåŠŸï¼');
                addResult('data', JSON.stringify(result.data, null, 2));

            } catch (error) {
                addResult('error', `å¿«é€Ÿåˆ†äº«å¤±è´¥: ${error.message}`);
            }
        }

        // æ·»åŠ ç»“æœåˆ°æ˜¾ç¤ºåŒºåŸŸ
        function addResult(type, content) {
            const resultDiv = document.getElementById('result');
            const timestamp = new Date().toLocaleTimeString();
            const prefix = {
                'info': '[INFO]',
                'success': '[SUCCESS]',
                'error': '[ERROR]',
                'data': '[DATA]',
                'logs': '[LOGS]'
            }[type] || '[LOG]';
            
            resultDiv.textContent += `${timestamp} ${prefix} ${content}\n\n`;
            resultDiv.scrollTop = resultDiv.scrollHeight;
        }

        // æ¸…ç©ºç»“æœ
        function clearResult() {
            document.getElementById('result').textContent = 'æš‚æ— æ“ä½œç»“æœ';
        }

        // ç›‘å¬æ‰©å±•å°±ç»ªäº‹ä»¶
        window.addEventListener('multipostExtensionReady', (event) => {
            addResult('info', `æ‰©å±•å°±ç»ªäº‹ä»¶: ${JSON.stringify(event.detail)}`);
            checkExtensionStatus();
        });

        // é¡µé¢åŠ è½½å®Œæˆåæ£€æŸ¥çŠ¶æ€
        document.addEventListener('DOMContentLoaded', () => {
            // å»¶è¿Ÿæ£€æŸ¥ï¼Œç¡®ä¿æ‰©å±•æœ‰æ—¶é—´åˆå§‹åŒ–
            setTimeout(checkExtensionStatus, 1000);
        });

        // å¼€å‘ç¯å¢ƒè°ƒè¯•
        if (window.multipostExtensionDebug) {
            console.log('ğŸ”§ å¼€å‘è°ƒè¯•å·¥å…·å·²å°±ç»ª');
            console.log('ä½¿ç”¨ window.multipostExtensionDebug.checkStatus() æ£€æŸ¥çŠ¶æ€');
            console.log('ä½¿ç”¨ window.multipostExtensionDebug.testShare() å¿«é€Ÿæµ‹è¯•');
        }
    </script>
</body>
</html> 